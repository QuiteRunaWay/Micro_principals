# Домашнее задание к занятию "11.02 Микросервисы: принципы"

Вы работаете в крупной компанию, которая строит систему на основе микросервисной архитектуры. Вам как DevOps специалисту необходимо выдвинуть предложение по организации инфраструктуры, для разработки и эксплуатации.

## Задача 1: API Gateway
Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

Решение должно соответствовать следующим требованиям:
- Маршрутизация запросов к нужному сервису на основе конфигурации
- Возможность проверки аутентификационной информации в запросах
- Обеспечение терминации HTTPS

Обоснуйте свой выбор.

### Ответ: 

1.	Amazon API Gateway (https://aws.amazon.com/ru/api-gateway/, https://docs.aws.amazon.com/apigateway/latest/developerguide/welcome.html) : по заверениям производителя их решение позволяет создавать, обслуживать и обеспечивает безопасность API при любых масштабах. В составе есть механизмы, как нам требуются: аутентификация (с помощью AWS Identity and Access Management (IAM) и Amazon Cognito), безопасность и шифрование трафика (AWS Direct Connect, Amazon VPC), маршрутизация запросов к нужным сервисам (Amazon Route 53).

2.	Microsoft предлагает (https://docs.microsoft.com/ru-ru/dotnet/architecture/microservices/architect-microservice-container-applications/direct-client-to-microservice-communication-versus-the-api-gateway-pattern) использовать шлюза API под управлением своего собственного решения API Azure. В итоге служба управления API Azure будет удовлетворять потребностям которые нам необходимы, а именно: аутентификация, маршрутизация, защита трафика.
По заверениям Microsoft, для служб, развернутых на Microsoft Azure лучше всего использовать API шлюз на основе их решения API Azure.
Так же в статье Microsoft приводят в пример еще один продукт API Gateway «Ocelot» (https://github.com/ThreeMammals/Ocelot). Это API шлюз на основе .NET Core. 
По заверениям Microsoft, данный продукт прекрасно работает с микрослужбами и контейнерами, такими как, например, Docker, Kubernetes. Так как этот шлюз основан на .NET Core, он одинаково хорошо работает на платформах Windows или Linux.
Из описания на GitHub можно убедиться, что данный продукт так же поддерживает маршрутизацию, аутентификацию и авторизацию (IdentityServer), и проверку трафика.

3.	И для примера еще приведу одно решение: Yandex API Gateway (https://cloud.yandex.ru/services/api-gateway). Данное решение от российского производителя, утверждающего, что его решение обеспечивает минимальную задержку запросов до сервисов, легко масштабируется, имеет возможности по расширению спецификации (Статический отчет, вызов функции, авторизация с помощью функции, обращение по HTTP), а так же поддерживает интеграцию с облачными сервисами Yandex Cloud .

| Наименование решения | Маршрутизация запросов к нужному сервису на основе конфигурации | Возможность проверки аутентификационной информации в запросах | Обеспечение терминации HTTPS |
|-----------------------------------|-----------------------------------------------------------------|---------------------------------------------------------------|------------------------------|
| Amazon API Gateway                | +                                                               | +                                                             | +                            |
| Microsoft API Azure               | +                                                               | +                                                             | +                            |
| API Gateway Ocelot                | +                                                               | +                                                             | +                            |
| Yandex API Gateway                | +                                                               | +                                                             | +                            |

Подведя итог вышесказанному: все из сервисов будут соответствовать нашим требованиям по безопасности, маршрутизации и защите трафика. Вибирать стоит из того, какая команда у нас сейчас есть, её знания (какими навыками работы обладают), чтобы понимать сможем ли мы обслуживать далее данный продукт самостоятельно.
В свою очередь необходимо отметить, что всё это облачные решения, что в свою очередь даёт один значительный минус – если есть проблемы с каналом – значит все наши сервисы за шлюзом будут недоступны. Но данные минус нивелируется теми преимуществами, которые позволяет данный шлюз реализовать, в частности – скрыть внутреннюю сложность нашей системы от внешнего пользователя.

## Задача 2: Брокер сообщений

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Решение должно соответствовать следующим требованиям:
- Поддержка кластеризации для обеспечения надежности
- Хранение сообщений на диске в процессе доставки
- Высокая скорость работы
- Поддержка различных форматов сообщений
- Разделение прав доступа к различным потокам сообщений
- Протота эксплуатации

Обоснуйте свой выбор.

### Ответ: 

| Наименование брокера сообщений | Поддержка кластеризации для обеспечения надежности | Хранение сообщений на диске в процессе доставки | Высокая скорость работы | Поддержка различных форматов сообщений | Разделение прав доступа к различным потокам сообщений | Проcтота эксплуатации |
|--------------------------------|----------------------------------------------------|-------------------------------------------------|-------------------------|----------------------------------------|-------------------------------------------------------|-----------------------|
| RabbitMQ                       | **+**                                              | **+**                                           | **+**                   | **+**                                  | **+**                                                 | **+**                 |
| Apache Kafka                   | **+**                                              | **+**                                           | **+**                   | **+**                                  | **+**                                                 | **+**                 |
| Platform V Corax               | **+**                                              | **+**                                           | **+**                   | **+**                                  | **+**                                                 | -                     |
| ActiveMQ                       | **+**                                              | **+**                                           | -                       | **+**                                  | **+**                                                 | **+**                 |

Для подготовки итоговой таблицы я использовал следующие источники:

https://habr.com/ru/company/vivid_money/blog/534858/

https://kafka.apache.org/31/documentation.html#introduction 

https://habr.com/ru/company/sberbank/blog/669456/

https://www.rabbitmq.com/documentation.html 

https://selectel.ru/blog/apache-kafka/

https://activemq.apache.org/components/classic/documentation


На основе сделанного анализа можно сказать, что для решения поставленной задачи можно будет использовать один из 2 представленных брокеров сообщений, это RabbitMQ или Apache Kafka. Оба этих брокера соответствуют всем заявленным требованиям.
Платформа Platform V Corax является собственной разработкой Сбербанка, информации по ней крайне мало нашел. Продукт новый, и как мне кажется, что он написан для узкого круга лиц, что автоматически делает его тяжелым в эксплуатации, если не сказать, что придется приглашать специалистов со стороны чтобы его обслуживать.
Из всех представленных брокеров сообщений я сам работал только c ActiveMQ (используется для взаимодействия с Федеральным реестром гос.услуг и Региональным реестром гос. услуг), по этому могу сказать, что по скорости он действительно не сильно быстрый, эту оценку я ему поставил от себя лично.
